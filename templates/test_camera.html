<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Compatibilidad de C√°mara</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        #video {
            width: 100%;
            max-width: 400px;
            border: 2px solid #ddd;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <h1>üîç Test de Compatibilidad de C√°mara</h1>
    
    <div class="test-section">
        <h2>üìã Informaci√≥n del Navegador</h2>
        <div id="browser-info"></div>
    </div>

    <div class="test-section">
        <h2>üîß Compatibilidad de APIs</h2>
        <div id="api-tests"></div>
    </div>

    <div class="test-section">
        <h2>üì∑ Test de C√°mara</h2>
        <button id="testCamera">Probar C√°mara</button>
        <button id="stopCamera" disabled>Detener C√°mara</button>
        <br><br>
        <video id="video" autoplay playsinline></video>
        <div id="camera-status"></div>
    </div>

    <script>
        let stream = null;

        // Browser info
        function showBrowserInfo() {
            const info = document.getElementById('browser-info');
            info.innerHTML = `
                <p><strong>User Agent:</strong> ${navigator.userAgent}</p>
                <p><strong>Navegador:</strong> ${getBrowserName()}</p>
                <p><strong>Versi√≥n:</strong> ${getBrowserVersion()}</p>
                <p><strong>Protocolo:</strong> ${location.protocol}</p>
                <p><strong>Hostname:</strong> ${location.hostname}</p>
                <p><strong>Contexto Seguro:</strong> ${window.isSecureContext ? '‚úÖ S√≠' : '‚ùå No'}</p>
            `;
        }

        function getBrowserName() {
            const ua = navigator.userAgent;
            if (ua.includes('Chrome')) return 'Chrome';
            if (ua.includes('Firefox')) return 'Firefox';
            if (ua.includes('Safari') && !ua.includes('Chrome')) return 'Safari';
            if (ua.includes('Edge')) return 'Edge';
            return 'Desconocido';
        }

        function getBrowserVersion() {
            const ua = navigator.userAgent;
            const match = ua.match(/(Chrome|Firefox|Safari|Edge)\/(\d+)/);
            return match ? match[2] : 'Desconocida';
        }

        // API tests
        function testAPIs() {
            const tests = document.getElementById('api-tests');
            const results = [];

            // Test navigator.mediaDevices
            if (navigator.mediaDevices) {
                results.push('<span class="status success">‚úÖ navigator.mediaDevices disponible</span>');
            } else {
                results.push('<span class="status error">‚ùå navigator.mediaDevices no disponible</span>');
            }

            // Test getUserMedia
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                results.push('<span class="status success">‚úÖ getUserMedia disponible</span>');
            } else if (navigator.webkitGetUserMedia || navigator.mozGetUserMedia) {
                results.push('<span class="status warning">‚ö†Ô∏è getUserMedia disponible (legacy)</span>');
            } else {
                results.push('<span class="status error">‚ùå getUserMedia no disponible</span>');
            }

            // Test secure context
            if (window.isSecureContext) {
                results.push('<span class="status success">‚úÖ Contexto seguro</span>');
            } else if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
                results.push('<span class="status warning">‚ö†Ô∏è Contexto local (OK para desarrollo)</span>');
            } else {
                results.push('<span class="status error">‚ùå Contexto no seguro (requiere HTTPS)</span>');
            }

            tests.innerHTML = results.join('<br>');
        }

        // Camera test
        document.getElementById('testCamera').addEventListener('click', async () => {
            const status = document.getElementById('camera-status');
            const video = document.getElementById('video');
            const testBtn = document.getElementById('testCamera');
            const stopBtn = document.getElementById('stopCamera');

            try {
                status.innerHTML = '<span class="status warning">üîÑ Iniciando c√°mara...</span>';

                // Check compatibility
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    throw new Error('getUserMedia no est√° disponible en este navegador');
                }

                stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        width: { ideal: 640 },
                        height: { ideal: 480 }
                    }
                });

                video.srcObject = stream;
                
                video.onloadedmetadata = () => {
                    status.innerHTML = '<span class="status success">‚úÖ C√°mara iniciada correctamente</span>';
                    testBtn.disabled = true;
                    stopBtn.disabled = false;
                };

                video.onerror = () => {
                    throw new Error('Error al cargar el video');
                };

            } catch (error) {
                console.error('Camera error:', error);
                let errorMsg = 'Error al acceder a la c√°mara: ';
                
                switch (error.name) {
                    case 'NotAllowedError':
                        errorMsg += 'Permiso denegado';
                        break;
                    case 'NotFoundError':
                        errorMsg += 'No se encontr√≥ c√°mara';
                        break;
                    case 'NotSupportedError':
                        errorMsg += 'No soportado';
                        break;
                    case 'NotReadableError':
                        errorMsg += 'C√°mara en uso';
                        break;
                    default:
                        errorMsg += error.message;
                }
                
                status.innerHTML = `<span class="status error">‚ùå ${errorMsg}</span>`;
            }
        });

        document.getElementById('stopCamera').addEventListener('click', () => {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            document.getElementById('video').srcObject = null;
            document.getElementById('camera-status').innerHTML = '<span class="status warning">‚èπÔ∏è C√°mara detenida</span>';
            document.getElementById('testCamera').disabled = false;
            document.getElementById('stopCamera').disabled = true;
        });

        // Initialize tests
        window.addEventListener('load', () => {
            showBrowserInfo();
            testAPIs();
        });
    </script>
</body>
</html>
